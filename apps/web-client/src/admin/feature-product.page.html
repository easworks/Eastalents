<mat-accordion multi class="block m-4">
    @for (fdp of featured.mapped$(); track fdp.domain.id) {
    <mat-expansion-panel expanded>
        <mat-expansion-panel-header>
            <mat-panel-title>
                {{fdp.domain.longName}}
            </mat-panel-title>
            <mat-divider></mat-divider>
            <button class="icon-button mr-4" mat-ripple
                    (click)="domains.remove(fdp.domain);">
                <fa-icon [icon]="icons.faTrashCan" class="text-warn"></fa-icon>
            </button>
        </mat-expansion-panel-header>

        <div class="mb-4 flex flex-wrap gap-2" cdkDropList cdkDropListOrientation="horizontal"
             (cdkDropListDropped)="fdp.software.dropped($event)"
             [class.hidden]="!fdp.software.selected.length">
            @for(option of fdp.software.selected; track option.value.id) {
            <div class="chip w-max" cdkDrag>
                <span>{{option.value.name}}</span>
                <button type="button" mat-ripple class="icon-button" title="Remove"
                        (click)="fdp.software.remove($index)">
                    <fa-icon [icon]="icons.faSquareXmark"></fa-icon>
                </button>
            </div>
            }
        </div>

        <div class="form-field mb-0">
            <label>Add New Featured Product</label>
            <input type="text" placeholder="Type to search"
                   [ngModel]="fdp.add.query$()"
                   (ngModelChange)="fdp.add.onChange($event)"
                   [matAutocomplete]="productOptions"
                   [class.!pr-10]="fdp.add.valid$()">

            <mat-autocomplete #productOptions class="!p-0" [displayWith]="fdp.add.displayFn">
                @for(option of fdp.add.options$(); track option.value.id) {
                <mat-option [value]="option">{{option.label}}</mat-option>
                }
            </mat-autocomplete>

            @if (fdp.add.valid$()) {
            <button class="icon-button absolute right-0 top-6" mat-ripple
                    (click)="fdp.software.add()">
                <fa-icon class="text-emerald-500 text-xl"
                         [icon]="icons.faCircleCheck"></fa-icon>
            </button>
            }

        </div>

    </mat-expansion-panel>
    }


    <mat-expansion-panel expanded>
        <mat-expansion-panel-header>
            <mat-panel-title>
                Select New Featured Domain
            </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="form-field mb-0">
            <input type="text" placeholder="Type to search"
                   [ngModel]="domains.query$()"
                   (ngModelChange)="domains.onChange($event)"
                   [matAutocomplete]="domainOptions"
                   [class.!pr-10]="domains.valid$()">

            @if (domains.valid$()) {
            <button class="icon-button absolute right-0 top-0" mat-ripple
                    (click)="domains.submit()">
                <fa-icon class="text-emerald-500 text-xl"
                         [icon]="icons.faCircleCheck"></fa-icon>
            </button>
            }
        </div>

        <mat-autocomplete #domainOptions class="!p-0" [displayWith]="domains.displayFn">
            @for(option of domains.filtered$(); track option.id) {
            <mat-option [value]="option">
                {{option.longName}}
            </mat-option>
            }
        </mat-autocomplete>

    </mat-expansion-panel>
</mat-accordion>