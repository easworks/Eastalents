<mat-sidenav-container class="h-full">
  <mat-sidenav [opened]="showInfoPanel$()" mode="side" position="end">
    <div class="demo-placeholder">
      Message Room Info Panel
    </div>
  </mat-sidenav>
  <mat-sidenav-content style="overflow: visible;">
    <mat-progress-spinner *ngIf="loadingRoom$(); else $roomLoaded"
                          mode="indeterminate" diameter="24"
                          class="mx-auto my-4">
    </mat-progress-spinner>

    <ng-template #$roomLoaded>
      <div class="h-full flex flex-col justify-end" *ngIf="room$(); else $noRoom">
        <div class="messages-container">
          <div *ngFor="let message of messages.list$(); trackBy: trackBy.message"
               class="message"
               [class.self]="message.self">
            <p>{{message.data.text}}</p>
            <p class="time">{{message.data.createdAt}}</p>
          </div>
        </div>
        <mat-divider></mat-divider>
        <div class="bg-white p-2">
          <form class="flex gap-2" (ngSubmit)="messages.send()">
            <input #fileInput type="file" class="hidden"
                   (input)="messages.files.update(fileInput)"
                   accept="*/*">
            <button type="button" class="icon-button self-end text-slate-400 
              enabled:hover:text-inherit enabled:focus:text-inherit"
                    (click)="fileInput.click()">
              <fa-icon [icon]="icons.faPaperclip"></fa-icon>
            </button>
            <div id="text-message-field" *ngIf="messages.mode$() === 'text'; else $fileDisplay"
                 class="form-field mb-0 flex-grow self-center">
              <div class="field field-interactive">
                <textarea [formControl]="messages.text.form"
                          cdkTextareaAutosize
                          class="resize-none"
                          style="max-height: min(10rem, 30vh);"></textarea>
              </div>
            </div>
            <ng-template #$fileDisplay>
              <div id="file-message-field-container" class="flex-grow">
                <div *ngrxLet="messages.files.$()! as display"
                     class="file p-1 pl-4 border rounded
                        flex gap-4 items-center"
                     [class.error]="display.error">
                  <fa-icon [icon]="display.icon" class="text-2xl"></fa-icon>
                  <div>
                    <p class="text-sm font-bold">{{display.file.name}}</p>
                    <p class="text-xs">{{display.error}}</p>
                  </div>
                  <button class="icon-button ml-auto 
                    text-slate-400 hover:text-black">
                    <fa-icon [icon]="icons.faXmark"></fa-icon>
                  </button>
                </div>
              </div>
            </ng-template>
            <button type="submit" mat-ripple
                    [disabled]="messages.cannotSend$()"
                    class="icon-button self-end 
                    text-primary/70 disabled:text-slate-300
                    enabled:hover:text-primary 
                    enabled:focus:text-primary">
              <replace-spinner [showSpinner]="messages.sending$()">
                <fa-icon [icon]="icons.faPlay" class="ml-[0.3rem]"></fa-icon>
              </replace-spinner>

            </button>
          </form>
        </div>
      </div>

      <ng-template #$noRoom>
        <div class="h-full grid place-content-center p-4">
          <fa-icon [icon]="icons.faComments"
                   class="mx-auto text-6xl text-slate-300"></fa-icon>
          <p class="mt-4 text-slate-400">Please select a conversation to view messages</p>
        </div>
      </ng-template>
    </ng-template>

  </mat-sidenav-content>
</mat-sidenav-container>