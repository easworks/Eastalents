<div class="welcome-mat min-w-min 
      w-full lg:max-w-2xl transition-all"
     *ngIf="isNew">

  <div class="sticky p-4
        grid place-content-center justify-items-center
        bg-[#2f2e41] text-white"
       style="top: 4rem; height: calc(100vh - 4rem);">

    <div class="max-w-lg text-center">
      <lottie-player src="https://assets8.lottiefiles.com/packages/lf20_ureyqxyw.json"
                     loop autoplay class="h-auto"></lottie-player>

      <div class="mt-4">
        <h1 class="text-xl font-semibold">Welcome to EASWORKS</h1>
        <p class="mt-2 text-sm">
          Work With The World's Leading Companies By applying to join EASWORKS
          Enterprise Application software Talent Network,
          you are one step closer to finding your next role,
          advancing your career, and connecting with other
          talented engineers in our community. Cheers to that!
        </p>
      </div>
    </div>

  </div>

</div>

<div class="min-w-min page">
  <div class="mx-auto w-24 h-24">
    <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_m4gdjtfv.json"
                   loop autoplay>
    </lottie-player>
  </div>

  <div *ngIf="stepper.showStepControls$()" class="stepper-progress w-100 mt-4">
    <ng-container *ngrxLet="stepper.progress$() as progress">
      <span>{{progress.label}}</span>
      <mat-progress-bar [value]="progress.percent" class="mt-2 rounded-full"></mat-progress-bar>
    </ng-container>
  </div>


  <!-- Stepper container -->
  <div class="relative mt-8" *ngrxLet="stepper.step$() as step">

    <div *ngIf="step === 'start'">
      <p class="text-center">
        Please answer the following questions to complete your EASWorks Freelancer Profile.
      </p>
      <button type="button" class="highlight-button primary mt-4 mx-auto" style="display: block;"
              (click)="this.stepper.next.click()">
        Get Started
      </button>
    </div>

    <div *ngIf="step === 'professional-summary'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">Profile Summary with Enterprise Application Software (EAS) Details</h2>
      <mat-divider></mat-divider>
      <form *ngrxLet="professionalSummary.form as form"
            [formGroup]="form"
            class="p-4 grid gap-4">

        <div *ngrxLet="form.controls.summary as control"
             [formFieldControl]="control">
          <label class="!text-lg">
            Professional Summary
            <span class="text-warn">*</span>
          </label>
          <div class="field field-interactive h-64 mt-2">
            <textarea [formControl]="control"
                      placeholder="Please provide a summary of your professional background and experience in the field"
                      class="resize-none"></textarea>
          </div>
          <span class="error" *ngIf="control.hasError('required')">Required</span>
          <span class="error" *ngIf="control.hasError('wordlength')">{{professionalSummary.summaryWords$()}}/250 words</span>
          <span class="hint">{{professionalSummary.summaryWords$()}}/250 words</span>
          <p class="p-2 px-4 rounded text-sm bg-emerald-400/5 text-emerald-500 mt-8">The Professional Summary will remain confidential and visible exclusively to the EASWORKS screening team.</p>
        </div>

        <div *ngrxLet="form.controls.experience as control"
             [formFieldControl]="control">
          <label class="!text-lg">
            Overall Experience
            <span class="text-warn">*</span>
          </label>
          <p class="text-sm">Select the range that best represents your overall experience</p>
          <mat-select class="mt-2" [formControl]="control">
            <mat-option *ngFor="let opt of professionalSummary.options.all.experience"
                        [value]="opt">{{opt}}</mat-option>
          </mat-select>
        </div>

        <div>
          <label class="text-lg">Your Location and Time Zone</label>

          <button class="highlight-button mt-4 flex gap-2 items-center"
                  type="button" mat-ripple
                  (click)="professionalSummary.useCurrentLocation()">
            <i class="fas fa-location"></i>
            <span class="text-sm">Use current location</span>
          </button>

          <div class="mt-4">
            <div class="grid grid-cols-2 gap-x-4 md:gap-x-8 transition-all">
              <div *ngrxLet="form.controls.country as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  Country
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <span class="font-emoji absolute left-2 top-8" *ngIf="control.value as value">{{value.flag}}</span>
                <input type="text" [formControl]="control" [matAutocomplete]="countryOptions"
                       placeholder="Type to filter"
                       [class.!pl-10]="professionalSummary.showFlag$()">
                <mat-autocomplete #countryOptions [displayWith]="displayWith.country">
                  <mat-option *ngFor="let country of professionalSummary.options.filtered.country$(); trackBy: trackBy.country"
                              [value]="country">
                    <div class="flex gap-4 items-center">
                      <span class="font-emoji">{{country.flag}}</span>
                      <span>{{country.name}}</span>
                    </div>
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.state as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  State/Province
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>

                <input type="text" [formControl]="control" [matAutocomplete]="stateOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #stateOptions [displayWith]="displayWith.state">
                  <mat-option *ngFor="let state of professionalSummary.options.filtered.state$(); trackBy: trackBy.state"
                              [value]="state">
                    {{state.name}}
                  </mat-option>
                </mat-autocomplete>
                <span class="error" *ngIf="control.hasError('required')">Required</span>
                <span class="error" *ngIf="control.hasError('invalid')">Invalid</span>


                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.city as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  City/Area
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <input type="text" [formControl]="control" [matAutocomplete]="cityOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #cityOptions [displayWith]="displayWith.city">
                  <mat-option *ngFor="let city of professionalSummary.options.filtered.city$()"
                              [value]="city">
                    {{city.name}}
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.timezone as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  Time Zone
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <input type="text" [formControl]="control" [matAutocomplete]="tzOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #tzOptions [displayWith]="displayWith.timezone">
                  <mat-option *ngFor="let tz of professionalSummary.options.filtered.timezone$()"
                              [value]="tz">
                    {{tz.zoneName}}
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div class="col-span-2 rounded bg-warn/10 p-2 px-4 text-center text-warn">
                Need to integrate the Google API as well
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="step === 'primary-domains'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">Enterprise Application Domain Skills</h2>
      <mat-divider></mat-divider>

      <form *ngrxLet="primaryDomains.form as form"
            [formGroup]="form" class="p-4">
        <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
          <span class="font-medium lg:pt-1 transition-all"> Please select your domain of expertise in enterprise applications </span>
          <span class="flex-none flex gap-2 text-slate-500 items-center">
            <span class="fa-solid fa-circle-info text-lg"></span>
            <span>Select up to 3</span>
            <span *ngrxLet="primaryDomains.size$() as size"
                  class="selection-counter" [class.selected]="size > 0">
              {{size}} selected
            </span>
          </span>
        </label>
        <div *ngIf="!loadingData$(); else $dataLoading"
             class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">

          <ng-container *ngFor="let domain of primaryDomains.options$(); trackBy: trackBy.domainOption">
            <div class="primary-domain-option border rounded flex flex-col gap-2"
                 *ngrxLet="primaryDomains.stopInput$() && !domain.selected as disabled"
                 [class.disabled]="disabled"
                 [class.selected]="domain.selected">
              <div class="flex flex-grow cursor-pointer"
                   (click)="!disabled && primaryDomains.toggle(domain)">
                <mat-checkbox class="primary"
                              [ngModel]="domain.selected"
                              [ngModelOptions]="{ standalone: true }"
                              [disabled]="disabled">
                </mat-checkbox>
                <div class="flex-grow p-2">{{domain.label}}</div>
              </div>
              <div *ngIf="domain.selected && form.controls[domain.value.key] as control"
                   [formFieldControl]="control" class="px-2">
                <input type="number" [formControl]="control" placeholder="Years of Experience *"
                       min="1" max="30">
                <span class="error">1-30</span>
                <span class="hint">1-30</span>
              </div>
            </div>
          </ng-container>
        </div>
      </form>
    </div>

    <div *ngIf="step === 'services'"
         class="rounded bg-white mat-elevation-z1">
      <ng-container *ngIf="services.$() as service$">
        <h2 class="p-4 text-xl font-semibold">Expertise in {{services.stepLabel$()}} Services</h2>
        <mat-divider></mat-divider>

        <form *ngrxLet="service$.form as form" [formGroup]="form">
          <ng-container *ngFor="let domain of service$.domains; let last = last; trackBy: trackBy.domain">
            <div class="p-4" *ngrxLet="service$.options[domain.key] as options">
              <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
                <span class="font-medium lg:pt-1 transition-all">Please specify your areas of expertise within <span class="text-primary">{{domain.longName}}</span></span>
                <span class="flex-none flex gap-2 text-slate-500 items-center">
                  <span class="fa-solid fa-circle-info text-lg"></span>
                  <span>Select at least 1</span>
                  <span *ngrxLet="options.size$() as size"
                        class="selection-counter" [class.selected]="size > 0">
                    {{size}} selected
                  </span>
                </span>
              </label>

              <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
                <div *ngFor="let service of options.all; trackBy: trackBy.stringOption"
                     class="service-option border rounded flex flex-col gap-2"
                     [class.selected]="service.selected">
                  <div class="flex cursor-pointer flex-grow"
                       (click)="options.toggle(service)">
                    <mat-checkbox class="primary"
                                  [ngModel]="service.selected"
                                  [ngModelOptions]="{ standalone: true }">
                    </mat-checkbox>
                    <div class="flex-grow p-2">{{service.label}}</div>
                  </div>
                  <ng-container *ngIf="service.selected">
                    <div *ngrxLet="form.controls[domain.key].controls[service.value] as control"
                         [formFieldControl]="control" class="px-2">
                      <input type="number" [formControl]="control" placeholder="Years of Experience *"
                             min="1" max="30">
                      <span class="error">1-30</span>
                      <span class="hint">1-30</span>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>

            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </form>
      </ng-container>
    </div>

    <div *ngIf="step === 'modules'"
         class="rounded bg-white mat-elevation-z1">
      <ng-container *ngIf="modules.$() as modules$">
        <h2 class="p-4 text-xl font-semibold">{{modules.stepLabel$()}} Modules Expertise</h2>
        <mat-divider></mat-divider>

        <form *ngrxLet="modules$.form as form" [formGroup]="form">
          <ng-container *ngFor="let domain of modules$.domains; let last = last; trackBy: trackBy.domain">
            <div class="p-4" *ngrxLet="modules$.options[domain.key] as options">
              <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
                <span class="font-medium lg:pt-1 transition-all">Indicate the <span class="text-primary">{{domain.longName}}</span> modules you are proficient in</span>
                <span class="flex-none flex gap-2 text-slate-500 items-center">
                  <span class="fa-solid fa-circle-info text-lg"></span>
                  <span>Select up to 7</span>
                  <span *ngrxLet="options.size$() as size"
                        class="selection-counter" [class.selected]="size > 0">
                    {{size}} selected
                  </span>
                </span>
              </label>

              <!-- <div *ngIf="options.selectAll.visible"
                   class="border rounded flex max-w-max pr-4 cursor-pointer mt-4 lg:mt-2 transition-all"
                   (click)="options.selectAll.toggle()">
                <mat-checkbox class="primary"
                              [ngModel]="options.selectAll.value"
                              [ngModelOptions]="{ standalone: true }">
                </mat-checkbox>
                <div class="flex-grow p-2">Select All</div>
              </div> -->

              <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
                <ng-container *ngFor="let module of options.all; trackBy: trackBy.moduleOption">
                  <div *ngrxLet="options.stopInput$() && !module.selected as disabled"
                       class="module-option border rounded flex cursor-pointer"
                       [class.selected]="module.selected"
                       [class.disabled]="disabled"
                       (click)="!disabled && options.toggle(module)">
                    <mat-checkbox class="primary"
                                  [ngModel]="module.selected"
                                  [ngModelOptions]="{ standalone: true }"
                                  [disabled]="disabled">
                    </mat-checkbox>
                    <div class="flex-grow p-2">{{module.label}}</div>
                  </div>
                </ng-container>

              </div>
            </div>

            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </form>
      </ng-container>
    </div>

    <div *ngIf="step === 'software'"
         class="rounded bg-white mat-elevation-z1">
      <ng-container *ngIf="software.$() as software$">
        <h2 class="p-4 text-xl font-semibold">Proficiency in {{software.stepLabel$()}} Software</h2>
        <mat-divider></mat-divider>

        <form *ngrxLet="software$.form as form" [formGroup]="form">
          <ng-container *ngFor="let domain of software$.domains; let last = last; trackBy: trackBy.domain">
            <div class="p-4" *ngrxLet="software$.options[domain.key] as options">
              <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
                <span class="font-medium lg:pt-1 transition-all">Please indicate your proficiency level in <span class="text-primary">{{domain.longName}}</span> software</span>
                <span class="flex-none flex gap-2 text-slate-500 items-center">
                  <span class="fa-solid fa-circle-info text-lg"></span>
                  <span>Select up to 5</span>
                  <span *ngrxLet="options.size$() as size"
                        class="selection-counter" [class.selected]="size > 0">
                    {{size}} selected
                  </span>
                </span>
              </label>

              <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
                <ng-container *ngFor="let softOption of options.all; trackBy: trackBy.softwareOption">
                  <div *ngrxLet="options.stopInput$() && !softOption.selected as disabled"
                       class="software-option border rounded flex flex-col gap-2"
                       [class.selected]="softOption.selected"
                       [class.disabled]="disabled">
                    <div class="flex flex-grow cursor-pointer"
                         (click)="!disabled && options.toggle(softOption)">
                      <mat-checkbox class="primary"
                                    [ngModel]="softOption.selected"
                                    [ngModelOptions]="{ standalone: true }"
                                    [disabled]="disabled">
                      </mat-checkbox>
                      <div class="flex-grow p-2">{{softOption.label}}</div>
                    </div>
                    <div *ngIf="softOption.selected && form.controls[domain.key].controls[softOption.value.name] as control"
                         [formFieldControl]="control" class="px-2">
                      <input type="number" [formControl]="control" placeholder="Years of Experience *"
                             min="1" max="30">
                      <span class="error">1-30</span>
                      <span class="hint">1-30</span>
                    </div>
                  </div>
                </ng-container>

              </div>
            </div>

            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </form>
      </ng-container>
    </div>

    <div *ngIf="step === 'roles'"
         class="rounded bg-white mat-elevation-z1">
      <ng-container *ngIf="roles.$() as roles$">
        <h2 class="p-4 text-xl font-semibold">{{roles.stepLabel$()}} Roles</h2>
        <mat-divider></mat-divider>

        <form *ngrxLet="roles$.form as form" [formGroup]="form">
          <ng-container *ngFor="let domain of roles$.domains; let last = last; trackBy: trackBy.domain">
            <div class="p-4" *ngrxLet="roles$.options[domain.key] as options">
              <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
                <span class="font-medium lg:pt-1 transition-all">Please select the <span class="text-primary">{{domain.longName}}</span> roles you have worked in</span>
                <span class="flex-none flex gap-2 text-slate-500 items-center">
                  <span class="fa-solid fa-circle-info text-lg"></span>
                  <span>Select up to 5</span>
                  <span *ngrxLet="options.size$() as size"
                        class="selection-counter" [class.selected]="size > 0">
                    {{size}} selected
                  </span>
                </span>
              </label>

              <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
                <ng-container *ngFor="let roleOption of options.list; trackBy: trackBy.stringOption">
                  <div *ngrxLet="options.stopInput$() && !roleOption.selected as disabled"
                       class="role-option border rounded flex flex-col gap-2"
                       [class.selected]="roleOption.selected"
                       [class.disabled]="disabled">
                    <div class="flex flex-grow cursor-pointer"
                         (click)="!disabled && options.toggle(roleOption)">
                      <mat-checkbox class="primary"
                                    [ngModel]="roleOption.selected"
                                    [ngModelOptions]="{ standalone: true }"
                                    [disabled]="disabled">
                      </mat-checkbox>
                      <div class="flex-grow p-2">{{roleOption.label}}</div>
                    </div>
                    <div *ngIf="roleOption.selected && form.controls[domain.key].controls[roleOption.value] as control"
                         [formFieldControl]="control" class="px-2">
                      <input type="number" [formControl]="control" placeholder="Years of Experience *"
                             min="1" max="30">
                      <span class="error">1-30</span>
                      <span class="hint">1-30</span>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>

            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </form>
      </ng-container>
    </div>

    <div *ngIf="step === 'technology-stack'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">{{techExp.stepLabel$()}} Technical Experience</h2>
      <mat-divider></mat-divider>
      <div class="p-4">
        <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
          <span class="font-medium lg:pt-1 transition-all">Please choose the tech stack you have expertise in</span>
          <span class="flex-none flex gap-2 text-slate-500 items-center">
            <span *ngrxLet="techExp.size$() as size"
                  class="selection-counter"
                  [class.selected]="size > 0">
              {{size}} selected
            </span>
          </span>
        </label>
        <div *ngIf="techExp.skippable$()"
             class="rounded mt-4 p-2 px-4 bg-emerald-400/5 text-emerald-500">
          <button class="underline" (click)="techExp.skip()">Skip this question</button> if it is irrelevant to your enterprise application experience and skills.
        </div>

        <div *ngIf="techExp.size$() > 0"
             class="grid gap-4 mt-4">
          <div *ngFor="let entry of techExp.value$() | keyvalue">
            <label class="font-medium">{{entry.key}}</label>
            <!-- <div class="mt-2 flex flex-wrap gap-2"> -->
            <div class="mt-2 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
              <div *ngFor="let option of entry.value" class="bg-primary/5 text-primary rounded flex gap-2 justify-between ring-inset ring-primary ring-2">
                <span class="px-4 py-2">{{option.value}}</span>
                <button class="icon-button h-10 w-10 flex-none text-primary/70 hover:text-warn focus:text-warn transition-all" mat-ripple
                        type="button" (click)="techExp.remove(entry.key, option)"
                        title="Remove">
                  <i class="fas fa-square-xmark"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!techExp.stopInput$()" class="p-4">
        <div class="form-field !mb-0">
          <input type="text" placeholder="Type to filter"
                 [ngModel]="techExp.query$()"
                 (ngModelChange)="techExp.query$.set($event)"
                 [matAutocomplete]="techOptions">
          <span class="hint !relative">If the query matches a category, all items in the category will be shown, otherwise only matching items will be shown.</span>
          <span class="hint !relative">Selected items will be removed from suggestions.</span>
        </div>

        <mat-autocomplete #techOptions class="!p-0">
          <ng-container *ngFor="let group of techExp.filtered$(); let last = last; trackBy: trackBy.name">
            <mat-optgroup [label]="group.name" class="block pt-2">
              <mat-option *ngFor="let option of group.tech; trackBy: trackBy.stringOption"
                          [value]="techExp.query$()"
                          (onSelectionChange)="techExp.add(group.name, option);">
                {{option.label}}
              </mat-option>
            </mat-optgroup>
            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </mat-autocomplete>
      </div>
    </div>

    <div *ngIf="step === 'industry'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">Industry-specific {{industries.stepLabel$()}} Experience</h2>
      <mat-divider></mat-divider>
      <div class="p-4">
        <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
          <span class="font-medium lg:pt-1 transition-all">Please select the industries you have worked in</span>
          <span class="flex-none flex gap-2 text-slate-500 items-center">
            <span class="fa-solid fa-circle-info text-lg"></span>
            <span>Select up to 5</span>
            <span *ngrxLet="industries.size$() as size"
                  class="selection-counter"
                  [class.selected]="size > 0">
              {{size}} selected
            </span>
          </span>
        </label>

        <div *ngIf="industries.size$() > 0"
             class="grid gap-4 mt-4">
          <div *ngFor="let entry of industries.value$() | keyvalue">
            <label class="font-medium">{{entry.key}}</label>
            <!-- <div class="mt-2 flex flex-wrap gap-2"> -->
            <div class="mt-2 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
              <div *ngFor="let option of entry.value" class="bg-primary/5 text-primary rounded flex gap-2 justify-between ring-inset ring-primary ring-2">
                <span class="px-4 py-2">{{option.value}}</span>
                <button class="icon-button h-10 w-10 flex-none text-primary/70 hover:text-warn focus:text-warn transition-all" mat-ripple
                        type="button" (click)="industries.remove(entry.key, option)"
                        title="Remove">
                  <i class="fas fa-square-xmark"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!industries.stopInput$()" class="p-4">
        <div class="form-field !mb-0">
          <input type="text" placeholder="Type to filter"
                 [ngModel]="industries.query$()"
                 (ngModelChange)="industries.query$.set($event)"
                 [matAutocomplete]="industryOptions">
          <span class="hint !relative">If the query matches a category, all items in the category will be shown, otherwise only matching items will be shown.</span>
          <span class="hint !relative">Selected items will be removed from suggestions.</span>
        </div>

        <mat-autocomplete #industryOptions class="!p-0">
          <ng-container *ngFor="let group of industries.filtered$(); let last = last; trackBy: trackBy.name">
            <mat-optgroup [label]="group.name" class="block pt-2">
              <mat-option *ngFor="let option of group.industries; trackBy: trackBy.stringOption"
                          [value]="industries.query$()"
                          (onSelectionChange)="industries.add(group.name, option);">
                {{option.label}}
              </mat-option>
            </mat-optgroup>
            <mat-divider *ngIf="!last"></mat-divider>
          </ng-container>
        </mat-autocomplete>
      </div>
    </div>

    <div *ngIf="step === 'job-commitment'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">Type of Job Commitment</h2>
      <mat-divider></mat-divider>

      <form *ngrxLet="jobCommittment.form as form"
            class="p-4 grid gap-4">

        <div>
          <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
            <span class="font-medium lg:pt-1 transition-all">Specify your preferred Job Commitment</span>
            <span class="flex-none flex gap-2 text-slate-500 items-center">
              <span class="fa-solid fa-circle-info text-lg"></span>
              <span>Select at least 1</span>
            </span>
          </label>

          <div class="grid gap-4 mt-4 max-w-md">
            <button *ngFor="let option of jobCommittment.options; let i = index; trackBy: trackBy.stringOption"
                    type="button" class="commitment-option"
                    mat-ripple
                    [class.selected]="option.selected"
                    (click)="jobCommittment.toggle(option)">
              {{option.label}}

              <span *ngIf="i === 1" class="rounded p-1 px-2 text-sm text-emerald-400">
                <span class="fa-solid fa-thumbs-up mr-2"></span>
                <span>Recommended</span>
              </span>

            </button>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="step === 'rate-expectation'"
         class="rounded bg-white mat-elevation-z1">
      <h2 class="p-4 text-xl font-semibold">Rate Expectations</h2>
      <mat-divider></mat-divider>

      <div class="p-4">
        <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
          <span class="font-medium lg:pt-1 transition-all">Indicate your expected rate of remuneration</span>
          <span class="flex-none flex gap-2 text-slate-500 items-center">
            <span class="fa-solid fa-circle-info text-lg"></span>
            <span>Optional</span>
          </span>
        </label>

        <div class="rounded mt-4 p-2 px-4 bg-emerald-400/5 text-emerald-500 text-sm">
          Rate Expectation information is confidential and restricted to the EASWORKS screening team only.
        </div>

        <form *ngrxLet="rateExpectation.form as form"
              [formGroup]="form" class="mt-4">

          <div
               *ngrxLet="form.controls.hourly as control"
               [formFieldControl]="control">
            <label> Hourly </label>

            <div class="relative">
              <input type="number" [formControl]="control" placeholder="Expected hourly remuneration"
                     class="!pl-[6ch]" />
              <span class="h-full grid place-content-center absolute top-[0.05rem] left-0 p-2 
                  text-slate-500/80">USD</span>
            </div>
          </div>

          <div *ngrxLet="form.controls.monthly as control"
               [formFieldControl]="control">
            <label> Monthly </label>

            <div class="relative">
              <input type="number" [formControl]="control" placeholder="Expected monthly remuneration"
                     class="!pl-[6ch]" />
              <span class="h-full grid place-content-center absolute top-[0.05rem] left-0 p-2 
                    text-slate-500/80">USD</span>
            </div>
          </div>

          <div *ngrxLet="form.controls.annually as control"
               [formFieldControl]="control">
            <label> Annually </label>

            <div class="relative">
              <input type="number" [formControl]="control" placeholder="Expected annual remuneration"
                     class="!pl-[6ch]" />
              <span class="h-full grid place-content-center absolute top-[0.05rem] left-0 p-2 
                  text-slate-500/80">USD</span>
            </div>
          </div>

        </form>
      </div>
    </div>

    <div *ngIf="step === 'preferred-roles'"
         class="rounded bg-white mat-elevation-z1">
      <ng-container *ngIf="preferredRoles.$() as roles$">
        <h2 class="p-4 text-xl font-semibold">Preferred Roles</h2>
        <mat-divider></mat-divider>

        <ng-container *ngFor="let domain of roles$.domains; let last = last; trackBy: trackBy.domain">
          <div class="p-4" *ngrxLet="roles$.options[domain.key] as options">
            <label class="flex gap-1 flex-col justify-between lg:flex-row lg:gap-12 lg:items-start transition-all">
              <span class="font-medium lg:pt-1 transition-all">Please select the roles related to <span class="text-primary">{{domain.longName}}</span> you would like to work in</span>
              <span class="flex-none flex gap-2 text-slate-500 items-center">
                <span class="fa-solid fa-circle-info text-lg"></span>
                <span>Select up to 5</span>
                <span *ngrxLet="options.size$() as size"
                      class="selection-counter" [class.selected]="size > 0">
                  {{size}} selected
                </span>
              </span>
            </label>

            <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
              <ng-container *ngFor="let roleOption of options.list; trackBy: trackBy.stringOption">
                <button *ngrxLet="options.stopInput$() && !roleOption.selected as disabled"
                        type="button" mat-ripple
                        class="preferred-role-option"
                        [class.selected]="roleOption.selected"
                        [disabled]="disabled"
                        (click)="options.toggle(roleOption)">
                  {{roleOption.label}}
                </button>
              </ng-container>

            </div>
          </div>

          <mat-divider *ngIf="!last"></mat-divider>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <!-- Button Container -->
  <ng-container *ngIf="stepper.showStepControls$()">
    <div class="flex mt-4">
      <button *ngIf="stepper.prev.visible$()" mat-ripple
              type="button" class="stroked-button mr-auto enabled:bg-white enabled:border-transparent mat-elevation-z1 disabled:shadow-none"
              (click)="this.stepper.prev.click()">
        Previous
      </button>

      <ng-container *ngIf="stepper.next.visible$()">
        <button *ngrxLet="stepper.next.disabled$() as disabled"
                type="button" class="stroked-button ml-auto enabled:bg-white enabled:border-transparent mat-elevation-z1 disabled:shadow-none"
                mat-ripple [matRippleDisabled]="disabled"
                [disabled]="disabled"
                [disabled]="stepper.next.disabled$()"
                (click)="this.stepper.next.click()">
          Next
        </button>
      </ng-container>

      <ng-container *ngIf="stepper.submit.visible$()">
        <button *ngrxLet="stepper.submit.disabled$() as disabled"
                type="button" class="shaded-button ml-auto"
                mat-ripple [matRippleDisabled]="disabled"
                [disabled]="disabled"
                (click)="this.stepper.submit.click()">
          Submit
        </button>
      </ng-container>
    </div>
  </ng-container>

</div>

<ng-template #$dataLoading>
  <div class="mt-4 p-2 grid gap-4 justify-items-center">
    <p> Fetching data. Please wait... </p>
    <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
  </div>
</ng-template>