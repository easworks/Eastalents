<div class="welcome-mat min-w-min 
      w-full lg:max-w-2xl transition-all"
     *ngIf="isNew">

  <div class="sticky p-4
        grid place-content-center justify-items-center
        bg-[#2f2e41] text-white"
       style="top: 4rem; height: calc(100vh - 4rem);">

    <div class="max-w-lg text-center">
      <lottie-player src="https://assets8.lottiefiles.com/packages/lf20_ureyqxyw.json"
                     loop autoplay class="h-auto"></lottie-player>

      <div class="mt-4">
        <h1 class="text-xl font-semibold">Welcome to EASWORKS</h1>
        <p class="mt-2 text-sm">
          Work With The World's Leading Companies By applying to join EASWORKS
          Enterprise Application software Talent Network,
          you are one step closer to finding your next role,
          advancing your career, and connecting with other
          talented engineers in our community. Cheers to that!
        </p>
      </div>
    </div>

  </div>

</div>

<div class="min-w-min page">
  <div class="mx-auto w-24 h-24">
    <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_m4gdjtfv.json"
                   loop autoplay>
    </lottie-player>
  </div>

  <div *ngIf="stepper.showStepControls$()" class="stepper-progress w-100 mt-4">
    <ng-container *ngrxLet="stepper.progress$() as progress">
      <span>{{progress.label}}</span>
      <mat-progress-bar [value]="progress.percent" class="mt-2 rounded-full"></mat-progress-bar>
    </ng-container>
  </div>


  <!-- Stepper container -->
  <div class="relative mt-8" *ngrxLet="stepper.step$() as step">

    <div *ngIf="step === 'start'">
      <p class="text-center">
        Please answer the following questions to complete your EASWorks Freelancer Profile.
      </p>
      <button type="button" class="highlight-button primary mt-4 mx-auto" style="display: block;"
              (click)="this.stepper.next.click()">
        Get Started
      </button>
    </div>

    <div *ngIf="step === 'professional-summary'"
         class="rounded bg-white mat-elevation-z1 p-4">
      <form *ngrxLet="professionalSummary.form as form"
            [formGroup]="form">

        <div *ngrxLet="form.controls.summary as control"
             [formFieldControl]="control">
          <label class="!text-lg">
            Professional Summary
            <span class="text-warn">*</span>
          </label>
          <textarea [formControl]="control"
                    placeholder="Please tell us about yourself"
                    class="h-64 resize-none mt-2"></textarea>
          <span class="error">Required</span>
        </div>

        <div>
          <label class="text-lg">Your Location and Time Zone</label>

          <button class="highlight-button mt-4 flex gap-2 items-center"
                  type="button" mat-ripple
                  (click)="professionalSummary.useCurrentLocation()">
            <i class="fas fa-location"></i>
            <span class="text-sm">Use current location</span>
          </button>

          <div class="mt-4">
            <div class="grid grid-cols-2 gap-x-4 md:gap-x-8 transition-all">
              <div *ngrxLet="form.controls.country as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  Country
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <span class="font-emoji absolute left-2 top-8" *ngIf="control.value as value">{{value.flag}}</span>
                <input type="text" [formControl]="control" [matAutocomplete]="countryOptions"
                       placeholder="Type to filter"
                       class="transition-all" [class.!pl-10]="professionalSummary.showFlag$()">
                <mat-autocomplete #countryOptions [displayWith]="professionalSummary.displayWith.country">
                  <mat-option *ngFor="let country of professionalSummary.options.filtered.country$(); trackBy: professionalSummary.trackBy.country"
                              [value]="country">
                    <div class="flex gap-4 items-center">
                      <span class="font-emoji">{{country.flag}}</span>
                      <span>{{country.name}}</span>
                    </div>
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.state as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  State/Province
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>

                <input type="text" [formControl]="control" [matAutocomplete]="stateOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #stateOptions [displayWith]="professionalSummary.displayWith.state">
                  <mat-option *ngFor="let state of professionalSummary.options.filtered.state$(); trackBy: professionalSummary.trackBy.state"
                              [value]="state">
                    {{state.name}}
                  </mat-option>
                </mat-autocomplete>
                <span class="error" *ngIf="control.hasError('required')">Required</span>
                <span class="error" *ngIf="control.hasError('invalid')">Invalid</span>


                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.city as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  City/Area
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <input type="text" [formControl]="control" [matAutocomplete]="cityOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #cityOptions [displayWith]="professionalSummary.displayWith.city">
                  <mat-option *ngFor="let city of professionalSummary.options.filtered.city$()"
                              [value]="city">
                    {{city.name}}
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div *ngrxLet="form.controls.timezone as control"
                   [formFieldControl]="control"
                   [class.show-spinner]="professionalSummary.loading.geo$()">
                <label>
                  Time Zone
                  <span class="text-warn" *ngIf="control.enabled">*</span>
                </label>
                <input type="text" [formControl]="control" [matAutocomplete]="tzOptions"
                       placeholder="Type to filter">
                <mat-autocomplete #tzOptions [displayWith]="professionalSummary.displayWith.timezone">
                  <mat-option *ngFor="let tz of professionalSummary.options.filtered.timezone$()"
                              [value]="tz">
                    {{tz.zoneName}}
                  </mat-option>
                </mat-autocomplete>
                <mat-progress-spinner class="field-spinner right-6 top-8"
                                      mode="indeterminate" diameter="24"></mat-progress-spinner>
              </div>

              <div class="col-span-2 rounded bg-warn/10 p-2 px-4 text-center text-warn">
                Need to integrate the Google API as well
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="step === 'primary-domains'"
         class="rounded bg-white mat-elevation-z1 p-4">

      <form *ngrxLet="primaryDomains.form as array">
        <label class="text-lg">Please select Your Primary Enterprise Application Domain(s)</label>

        <ng-container *ngIf="array.length; else noItemsSelected">
          <div class="mt-4 grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
            <div *ngFor="let form of array.controls; let i = index; trackBy: primaryDomains.trackBy.controls"
                 class="border rounded p-2 pl-4 flex gap-2 items-stretch">

              <div class="flex-grow flex flex-col gap-4">
                <span class="flex-grow pt-2">{{form.value.domain?.value?.longName}}</span>
                <div *ngrxLet="form.controls.years as control" [formFieldControl]="control">
                  <input type="number" [formControl]="control" placeholder="Years of Experience"
                         min="1" max="30">
                  <span class="hint">1-30</span>
                </div>
              </div>

              <button class="icon-button h-10 w-10 flex-none text-warn/80" mat-ripple
                      type="button" (click)="primaryDomains.remove(i)"
                      title="Remove">
                <i class="fas fa-circle-minus"></i>
              </button>
            </div>
          </div>
        </ng-container>

        <ng-template #noItemsSelected>
          <div class="mt-4 border rounded p-2 mx-auto text-center">
            <i>Please select from the list below</i>
          </div>
        </ng-template>
      </form>

      <div class="mt-4" *ngIf="primaryDomains.options.visible$()">
        <input type="text" placeholder="Type to filter"
               [ngModel]="primaryDomains.options.filterText$()"
               (ngModelChange)="primaryDomains.options.filterText$.set($event)">

        <div *ngIf="primaryDomains.options.loading$(); else optionsLoaded"
             class="mt-4 p-2 grid gap-4 justify-items-center">
          <p> Fetching data. Please wait... </p>
          <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
        </div>
        <ng-template #optionsLoaded>
          <ul class="mt-4 grid gap-4 primary-domain-options"
              style="grid-template-columns: repeat(auto-fill, minmax(12rem, 1fr));">
            <li *ngFor="let option of primaryDomains.options.filtered$(); trackBy: primaryDomains.trackBy.options">
              <button class="stroked-button w-full h-full" mat-ripple
                      [title]="option.title"
                      [class.selected]="option.selected"
                      [disabled]="option.selected"
                      (click)="primaryDomains.select(option)">
                {{option.label}}
              </button>
            </li>
          </ul>

        </ng-template>
      </div>
    </div>

    <div *ngIf="step === 'services'"
         class="rounded bg-white mat-elevation-z1 p-4">
      <label class="text-lg">Please select the service(s) that you have worked on</label>

      <ng-container *ngrxLet="services.$() as services$">
        <form *ngrxLet="services$.form as array" class="grid gap-4 mt-4">

          <ng-container *ngFor="let domain of array.controls; let di = index; trackBy: services.trackBy.domains">
            <div *ngrxLet="domain.controls.services as array">
              <label>{{domain.value.domain?.longName}}</label>

              <div *ngIf="array.length; else noItemsSelected"
                   class="grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));">
                <div *ngFor="let service of array.controls; let si = index; trackBy: services.trackBy.controls"
                     class="border rounded p-2 pl-4 flex gap-2 items-stretch">
                  <div class="flex-grow flex flex-col gap-4">
                    <span class="flex-grow pt-2">{{service.value.service?.value}}</span>
                    <div *ngrxLet="service.controls.years as control" [formFieldControl]="control">
                      <input type="number" [formControl]="control" placeholder="Years of Experience"
                             min="1" max="30">
                      <span class="hint">1-30</span>
                    </div>
                  </div>

                  <button class="icon-button h-10 w-10 flex-none text-warn/80" mat-ripple
                          type="button" (click)="services$.options[di].remove(si)"
                          title="Remove">
                    <i class="fas fa-circle-minus"></i>
                  </button>
                </div>
              </div>

              <ng-template #noItemsSelected>
                <div class="border rounded p-2 mx-auto text-center">
                  <i>Please select from the list below</i>
                </div>
              </ng-template>
            </div>

            <div *ngIf="services$.options[di].visible$()">
              <input type="text" placeholder="Type to filter"
                     [ngModel]="services$.options[di].query$()"
                     (ngModelChange)="services$.options[di].query$.set($event)"
                     [ngModelOptions]="{ standalone: true }"
                     [matAutocomplete]="serviceOptions">

              <mat-autocomplete #serviceOptions [displayWith]="services.displayWith.none"
                                (optionSelected)="services$.options[di].add($event.option.value)">
                <mat-option *ngFor="let service of services$.options[di].filtered$(); trackBy: services.trackBy.service" [value]="service">{{service.value}}</mat-option>
              </mat-autocomplete>
            </div>
          </ng-container>

        </form>
      </ng-container>
    </div>
  </div>

  <!-- Button Container -->
  <ng-container *ngIf="stepper.showStepControls$()">
    <div class="flex mt-4">
      <button *ngIf="stepper.prev.visible$()" mat-ripple
              type="button" class="stroked-button mr-auto enabled:bg-white enabled:border-transparent mat-elevation-z1 disabled:shadow-none"
              (click)="this.stepper.prev.click()">
        Previous
      </button>

      <button *ngIf="stepper.next.visible$()" mat-ripple
              type="button" class="stroked-button ml-auto enabled:bg-white enabled:border-transparent mat-elevation-z1 disabled:shadow-none"
              [disabled]="stepper.next.disabled$()"
              (click)="this.stepper.next.click()">
        Next
      </button>

      <button *ngIf="stepper.submit.visible$()"
              type="button" class="shaded-button ml-auto"
              [disabled]="stepper.submit.disabled$()"
              (click)="this.stepper.submit.click()">
        Submit
      </button>
    </div>
  </ng-container>

</div>